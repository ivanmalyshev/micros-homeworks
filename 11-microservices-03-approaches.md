# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

Для обеспечения процесса разработки, хранения исходного кода, непрерывной интеграции (CI) и непрерывной поставки (CD) - Gitlab.

Gitlab - имеет обширный список инструментов, необходимые для процессов разработки.

+ GitLab CI/CD: Автоматизация процессов интеграции и развертывания, позволяющая автоматически тестировать и развертывать код.
+ GitLab Pages: Для хостинга статических сайтов прямо из репозиториев GitLab.
+ GitLab Runner: Для выполнения задач CI/CD на различных платформах и средах.
+ GitLab Merge Requests: Для код-ревью и обсуждения изменений.
+ GitLab Wiki: Для создания и поддержки документации проекта.
+ GitLab Security: Для обнаружения уязвимостей в коде и контейнерах.
+ GitLab Container Registry: Для хранения и управления Docker контейнерами.
+ GitLab Monitor: Для мониторинга производительности и доступности приложений.
+ GitLab Deploy Boards: Для визуализации и управления процессом развертывания.
+ GitLab Snippets: Для хранения и обмена фрагментами кода.
+ GitLab Geo: Для репликации репозиториев и данных между несколькими узлами GitLab.

Альтернативное решение - Jenkins для автоматизации, github(или gitlab) для хранения кода.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

Для решения задачи сбора и анализа логов в микросервисной архитектуре, можно использовать комбинацию следующих инструментов и практик:

**Fluent Bit или Filebeat** - сборщик логов

Fluentd и Fluent Bit поддерживают сбор логов из stdout, что соответствует требованию минимальных требований к приложениям. Они могут быть настроены для сбора логов с всех хостов, обслуживающих систему, и обеспечивают гарантированную доставку логов до центрального хранилища.

**Elasticsearch** - хранилище

В качестве центрального хранилища логов. Elasticsearch может быть интегрирован с Fluentd или Fluent Bit для обеспечения потоковой обработки и хранения логов.

**Kibana** - панель визуализации и анализа

Для предоставления пользовательского интерфейса визуализации и анализа данных в Elasticsearch. Она также позволяет создавать сохраненные поиски, которые можно использовать для быстрого доступа к часто используемым запросам.


## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

**Prometheus** для сбора метрик:
+ Сбор метрик со всех хостов: Prometheus может быть настроен на сборе метрик с всех хостов, используя различные экспортеры или агенты (например, Node Exporter для сбора метрик с хостов).
+ Сбор метрик состояния ресурсов хостов: С помощью Node Exporter можно собирать метрики CPU, RAM, HDD и сети.
+ Сбор метрик потребляемых ресурсов для каждого сервиса: Для сбора метрик, специфичных для сервисов, можно использовать экспортеры, разработанные специально для этих целей, или интегрировать Prometheus напрямую в сервисы для их экспорта.

**Grafana** для визуализации данных:
+ Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию: Grafana предлагает гибкие возможности для создания графиков и дашбордов, позволяя пользователям делать запросы к данным Prometheus и агрегировать информацию по различным параметрам.
+ Пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы: Пользователи могут создавать различные панели и дашборды, настраивая их в соответствии с требованиями мониторинга и анализа.

**Alertmanager** для уведомлений:
+ Гибкость и мощь: Prometheus и Grafana предлагают широкие возможности для сбора, анализа и визуализации метрик, что делает их идеальным выбором для мониторинга микросервисных архитектур.
+ Совместимость и интеграция: Эти инструменты легко интегрируются друг с другом и с другими системами, что обеспечивает полный контроль над процессом мониторинга и анализа.
+ Открытый исходный код: Все три инструмента являются проектами с открытым исходным кодом, что обеспечивает гибкость в настройке и расширении функционала.
+ Сообщество и поддержка: Благодаря большому сообществу разработчиков и пользователей, доступна обширная документация и поддержка, что значительно упрощает внедрение и использование.


## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout.

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.

### Результат выполнения:

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:

- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.

### Результат выполнения:

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
